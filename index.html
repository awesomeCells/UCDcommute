<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>UCD Commute</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš²</text></svg>">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- SVG Icons ---
    const IconBike = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2"/>
      </svg>
    );
    const IconSettings = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/>
      </svg>
    );
    const IconCalendar = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/>
      </svg>
    );
    const IconClock = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
      </svg>
    );
    const IconCheck = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/>
      </svg>
    );
    const IconAlert = ({ className }) => (
      <svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>
      </svg>
    );

    // --- Schedule Data ---
    const MWF_SAFE = [
      [0, 0, 7, 50], [8, 0, 8, 50], [9, 0, 9, 50], [10, 0, 10, 50], [11, 0, 11, 50],
      [12, 10, 13, 0], [13, 10, 14, 0], [14, 10, 15, 0], [15, 10, 16, 0], [16, 10, 17, 0],
      [17, 10, 18, 0], [18, 10, 19, 0], [19, 10, 20, 0], [20, 10, 23, 59]
    ];

    const TR_SAFE = [
      [0, 0, 7, 20], [7, 30, 8, 50], [9, 0, 10, 20], [10, 30, 11, 50],
      [12, 10, 13, 30], [13, 40, 15, 0], [15, 10, 16, 30], [16, 40, 18, 0],
      [18, 10, 19, 30], [19, 40, 20, 0], [20, 10, 23, 59]
    ];

    function App() {
      const [realTime, setRealTime] = useState(new Date());
      const [isSimulating, setIsSimulating] = useState(false);
      const [simTimeStr, setSimTimeStr] = useState("13:35");
      const [simDay, setSimDay] = useState(2); 
      
      useEffect(() => {
        const timer = setInterval(() => setRealTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      let activeDate = realTime;
      if (isSimulating) {
        const [hours, minutes] = simTimeStr.split(':').map(Number);
        activeDate = new Date(realTime);
        activeDate.setHours(hours, minutes, 0, 0);
        const currentDay = activeDate.getDay();
        const dayDiff = simDay - currentDay;
        activeDate.setDate(activeDate.getDate() + dayDiff);
      }

      const formatTime = (date) => {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      };

      const getCommuteStatus = (date) => {
        const dayOfWeek = date.getDay();
        
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          return { isWeekend: true, isSafeNow: true, currentWindow: { start: "Anytime", end: "Anytime", durationMins: null }, upcoming: [] };
        }

        const safeSchedule = (dayOfWeek === 1 || dayOfWeek === 3 || dayOfWeek === 5) ? MWF_SAFE : TR_SAFE;
        const nowTime = date.getTime();
        
        let isSafeNow = false;
        let currentWindow = null;
        let upcoming = [];

        for (const [hStart, mStart, hEnd, mEnd] of safeSchedule) {
          const start = new Date(date);
          start.setHours(hStart, mStart, 0, 0);
          const end = new Date(date);
          end.setHours(hEnd, mEnd, 0, 0);
          
          const startTime = start.getTime();
          const endTime = end.getTime();

          if (nowTime >= startTime && nowTime < endTime) {
            isSafeNow = true;
            currentWindow = {
              startObj: start, endObj: end, start: formatTime(start), end: formatTime(end),
              durationMins: Math.floor((endTime - nowTime) / 60000)
            };
          } else if (startTime > nowTime) {
            upcoming.push({
              startObj: start, endObj: end, start: formatTime(start), end: formatTime(end),
              durationMins: Math.floor((endTime - startTime) / 60000)
            });
          }
        }
        return { isWeekend: false, isSafeNow, currentWindow, upcoming: upcoming.slice(0, 2) };
      };

      const status = getCommuteStatus(activeDate);
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

      return (
        <div className="min-h-screen bg-slate-50 flex justify-center items-start md:p-8">
          <div className="w-full max-w-md bg-white shadow-xl overflow-hidden md:rounded-2xl border-x border-b border-slate-100 min-h-screen md:min-h-fit">
            
            {/* Header */}
            <div className="bg-blue-900 p-6 text-white pt-10 md:pt-6">
              <div className="flex justify-between items-center mb-4">
                <h1 className="text-xl font-bold flex items-center gap-2">
                  <IconBike className="w-6 h-6" /> UC Davis Commute
                </h1>
                <button 
                  onClick={() => setIsSimulating(!isSimulating)}
                  className={`p-2 rounded-full transition-colors ${isSimulating ? 'bg-blue-700 text-blue-100' : 'bg-blue-800/50 text-blue-200 hover:bg-blue-700'}`}
                >
                  <IconSettings className="w-5 h-5" />
                </button>
              </div>
              
              <div className="flex items-center gap-3 text-blue-100 mb-1">
                <IconCalendar className="w-4 h-4" />
                <span className="font-medium">{days[activeDate.getDay()]}</span>
              </div>
              <div className="flex items-center gap-3 text-3xl font-light">
                <IconClock className="w-6 h-6 text-blue-300" />
                <span>{formatTime(activeDate)}</span>
                {isSimulating && <span className="text-xs bg-amber-500 text-amber-950 px-2 py-1 rounded-md font-bold ml-2 uppercase tracking-wide">Sim</span>}
              </div>
            </div>

            {/* Simulator Controls */}
            {isSimulating && (
              <div className="bg-amber-50 p-4 border-b border-amber-100">
                <p className="text-xs font-semibold text-amber-800 uppercase mb-3">Time Machine</p>
                <div className="flex gap-3">
                  <select 
                    value={simDay} onChange={(e) => setSimDay(Number(e.target.value))}
                    className="flex-1 bg-white border border-amber-200 rounded p-2 text-sm text-amber-900 focus:ring-amber-500"
                  >
                    <option value={1}>Mon (MWF)</option><option value={2}>Tue (TR)</option><option value={3}>Wed (MWF)</option>
                    <option value={4}>Thu (TR)</option><option value={5}>Fri (MWF)</option><option value={6}>Saturday</option>
                  </select>
                  <input 
                    type="time" value={simTimeStr} onChange={(e) => setSimTimeStr(e.target.value)}
                    className="flex-1 bg-white border border-amber-200 rounded p-2 text-sm text-amber-900 focus:ring-amber-500"
                  />
                </div>
              </div>
            )}

            {/* Status Content */}
            <div className="p-6">
              {status.isWeekend ? (
                <div className="bg-emerald-50 border border-emerald-100 rounded-xl p-5 text-center">
                  <IconCheck className="w-10 h-10 text-emerald-500 mx-auto mb-2" />
                  <h2 className="text-xl font-bold text-emerald-900 mb-1">Weekend / Off-Peak</h2>
                  <p className="text-emerald-700 text-sm">Campus is clear. Commute anytime!</p>
                </div>
              ) : (
                <div className="space-y-6">
                  <div className={`rounded-xl p-5 border ${status.isSafeNow ? 'bg-emerald-50 border-emerald-100' : 'bg-rose-50 border-rose-100'}`}>
                    <div className="flex items-start gap-4">
                      {status.isSafeNow ? <IconCheck className="w-8 h-8 text-emerald-500 flex-shrink-0" /> : <IconAlert className="w-8 h-8 text-rose-500 flex-shrink-0" />}
                      <div>
                        <h2 className={`text-lg font-bold ${status.isSafeNow ? 'text-emerald-900' : 'text-rose-900'}`}>
                          {status.isSafeNow ? 'Clear to Commute' : 'Class Transition Rush!'}
                        </h2>
                        {status.isSafeNow ? (
                          <p className="text-emerald-700 text-sm mt-1">You have <strong>{status.currentWindow.durationMins} minutes</strong> before the next wave of students.</p>
                        ) : (
                          <p className="text-rose-700 text-sm mt-1">Avoid navigating campus right now. Wait for the upcoming window.</p>
                        )}
                      </div>
                    </div>
                  </div>

                  <div>
                    <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3 px-1">Upcoming Safe Windows</h3>
                    <div className="space-y-3">
                      {status.upcoming.map((window, idx) => (
                        <div key={idx} className="bg-white border border-slate-200 rounded-lg p-4 flex justify-between items-center shadow-sm">
                          <p className="font-semibold text-slate-800">{window.start} <span className="text-slate-400 font-normal mx-1">to</span> {window.end}</p>
                          <div className="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-xs font-medium">{window.durationMins} mins</div>
                        </div>
                      ))}
                      {status.upcoming.length === 0 && <p className="text-slate-500 text-sm italic px-1">No more commute windows today.</p>}
                    </div>
                  </div>
                </div>
              )}
            </div>
            
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
